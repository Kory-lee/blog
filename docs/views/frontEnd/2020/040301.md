---
title: 执行上下文
date: 2020-04-03
tags:
  - JavaScript
  - 学习笔记
categories:
  - frontEnd
publish: false
---

## 执行上下文

1. 代码分类(位置)

   - 全局代码
   - 函数(局部)代码

2. 全局执行上下文

   - 在执行全局代码前将 window 确定为全局执行上下文
   - 对全局数据进行预处理
     - `var`定义的全局变量==>`undefined`,添加为 window 的属性
     - function 声明的全局函数==>赋值,添加为 window 方法
     - this ==>赋值(window)

3. 函数执行上下文
   - 在调用函数前,准备执行函数体前,创建对应的<span style="border-bottom:2px solid blue;">函数执行上下文对象</span>(虚拟,存在于栈中)
   - 对局部数据进行预处理
     - 形参变量-->赋值(实参)-->添加为执行函数上下文的属性
     - arguments(伪数组) ==>赋值（实参列表）,添加为执行函数上下文的属性
     - `var`定义的局部变量==>`undefined`，添加为执行函数上下文的属性
     - `function`声明的函数==>赋值(fun), 添加为执行函数上下文的方法
     - this==>赋值(调用函数的对象)
   - 开始执行代码

```js
var c = 1;
function c(c) {
  //变量提升要优先于函数提升
  console.log(c);
  var c = 3;
}
c(2); //报错
```

## 执行上下文栈

1. 在全局代码执行前,`js`引擎就会创建一个栈来存储管理所有的执行上下文对象
2. 在全局执行上下文(window)确定后,将其添加到栈中(压栈)
3. 在函数执行上下文创建后,将其添加入栈中(压栈)
4. 在函数执行完后,将栈顶的对象移除(出栈)
5. 当所有的代码执行完后,栈中只剩 window

## 作用域和执行上下文

1. 区别 1
   1. 全局作用域之外,每个函数都会创建自己的作用域,作用域在函数定义之后就已经确定,而不是在函数调用时
   2. 全局执行上下文环境是在全局执行上下文确定之后,js 代码马上执行之前创建
   3. 函数执行上下文环境是在调用函数时,函数体代码执行之后创建
2. 区别 2
   1. 作用域是静态的,只要函数定义好了就一直存在,且不会再变化
   2. 上下文环境是静态的,调用函数时创建,函数调用结束后上下文环境就会被自动释放
3. 联系
   1. 上下文环境(对象)是从属于所在的作用域
   2. 全局上下文环境==>全局作用域
   3. 函数执行上下文环境==>对应的函数使用域

```js
var x = 10;
function fn() {
  console.log(x);
}
function show(f) {
  var x = 20;
  f();
}
show(fn); //10
```
